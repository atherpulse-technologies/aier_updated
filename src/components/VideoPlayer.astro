---
import { onMount } from 'astro/client';

export interface Props {
  src: string;
}
const { src } = Astro.props;

// Generate unique ID for each video player instance
const playerId = `player-${Math.random().toString(36).substr(2, 9)}`;
---

<!-- âœ… Include Plyr CSS from CDN -->
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

<!-- ðŸŽ¥ Self-hosted video -->
<video
  id={playerId}
  playsinline
  muted
  controls
  width="100%"
  height="100%"
  style="object-fit: cover;"
>
  <source src={src} type="video/mp4" />
  Your browser does not support HTML5 video.
</video>

<!-- âœ… Include Plyr JS from CDN -->
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<!-- ðŸ§  Init Plyr player -->
<script define:vars={{ playerId }}>
  document.addEventListener('DOMContentLoaded', () => {
    const player = new Plyr(`#${playerId}`, {
      controls: [
        'play-large',
        'play',
        'progress',
        'current-time',
        'mute',
        'volume',
        'fullscreen'
      ],
      autoplay: false,
      muted: true,
      clickToPlay: true,
      hideControls: true,
      // Custom CSS for better play button positioning
      settings: ['quality', 'speed'],
      invertTime: false,
      tooltips: { controls: true, seek: true },
    });

    // Add custom CSS for centered play button
    const style = document.createElement('style');
    style.textContent = `
      .plyr--video .plyr__control--overlaid {
        background: rgba(0, 0, 0, 0.7);
        border: 3px solid rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        color: rgba(255, 255, 255, 0.9);
        display: flex !important;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2;
        width: 80px;
        height: 80px;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }
      
      .plyr--video .plyr__control--overlaid:hover {
        background: rgba(0, 0, 0, 0.9);
        border-color: #fff;
        transform: translate(-50%, -50%) scale(1.1);
      }
      
      .plyr--playing .plyr__control--overlaid {
        display: none !important;
      }
      
      .plyr--video .plyr__control--overlaid svg {
        width: 28px;
        height: 28px;
        margin-left: 4px;
      }
      
      .plyr__controls {
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      
      .plyr:hover .plyr__controls,
      .plyr--playing .plyr__controls {
        opacity: 1;
      }
    `;
    document.head.appendChild(style);
  });
</script>
