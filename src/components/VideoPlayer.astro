---
import { onMount } from 'astro/client';
interface Props {
  videoId: string;
  title?: string;
  description?: string;
  autoplay?: boolean;
}

const { videoId, title, description, autoplay = false }
  = Astro.props;
---
<!-- 🧩 Plyr CSS from CDN (put in layout or here) -->
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

<!-- 🌐 YouTube Embed with Plyr UI only -->
<div
  class="plyr__video-embed"
  id="player"
  data-plyr-provider="youtube"
  data-plyr-embed-id={`${videoId}`}
></div>

<!-- 📜 Plyr JS from CDN -->
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<!-- 🚀 Init Plyr and autoplay -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const player = new Plyr('#player', {
      autoplay: true,
      muted: false, // Might be blocked by browser policy
      controls: [
        'play',
        'progress',
        'current-time',
        'mute',
        'volume',
        'fullscreen'
      ],
      youtube: {
        noCookie: true,
        rel: 0,
        showinfo: 0,
        modestbranding: 1
      }
    });

    player.once('ready', () => {
      player.play().catch(err => {
        console.warn('Autoplay failed (browser policy):', err);
      });
    });
  });
</script>
